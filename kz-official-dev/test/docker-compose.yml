version: '3.7'

x-node-env:
  &kz-env
    LOCAL_USER: "true"
    TERM: screen-256color
    KAZOO_COOKIE: change_me
    PATH: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/kazoo/_rel/kazoo/bin"

x-devol-cfg:
  &kz-vol
    - type: bind
      source: ${wKazoo}/master
      target: /opt/kazoo
      read_only: false
    - type: bind
      source: ./config.ini
      target: /etc/kazoo/config.ini

services:
  # couchdb:
  #   image: couchdb:latest
  #   hostname: 'couchdb.dev'
  #   environment:
  #     NODENAME: 'couchdb.dev'
  #   volumes:
  #     - type: bind
  #       source: ${wWork}/dockerfiles/kazoo/stacks/all_kz/couchdb_cluster.ini
  #       target: /opt/couchdb/etc/local.d/20-cluster.ini
  #   network_mode: host

  # rabbitmq:
  #   image: rabbitmq:3-management
  #   hostname: 'rabbitmq.dev'
  #   network_mode: host

  kazoo_apps:
    image: icehess/kz-dev-env:19
    hostname: 'kazoo_apps.dev'
    environment:
       << : *kz-env
       KAZOO_NODE: kazoo_apps
       NODE_NAME: kazoo_apps
       REL: kazoo_apps
       # KAZOO_APPS: "ecallmgr"
    volumes: *kz-vol
    tty: true
    command: ["bash"]
    network_mode: host

  freeswitch:
    image: icehess/kz-fs:latest
    hostname: 'freeswitch.dev'
    command: /usr/bin/docker-freeswitch start
    environment:
        LOCAL_USER: "true"
    network_mode: host

  # kamailio:
  #   image: icehess/kz-kam:latest
  #   hostname: 'kamailio.dev'
  #   command: /usr/bin/docker-kamailio start
  #   environment:
  #       LOCAL_USER: "true"
  #   network_mode: host

  # monster-ui:
  #   image: ${MONSTER_IMG:-node:8.11.3-stretch}
  #   hostname: 'portal.dev'
  #   environment:
  #      TERM: screen-256color
  #   volumes:
  #     - type: bind
  #       source: ./monster-entrypoint.sh
  #       target: /monster-entrypoint.sh
  #     - type: bind
  #       source: ${wKazoo}/monster-ui
  #       target: "/opt/monster-ui"
  #   tty: true
  #   entrypoint: /monster-entrypoint.sh
  #   command: ["/opt/monster-ui/node_modules/gulp/bin/gulp.js"]
  #   network_mode: host

  mailcatcher:
    image: 'schickling/mailcatcher'
    network_mode: host
